<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.bookandmovie.Dao.DiscussDao">
    <delete id="addLeader" parameterType="User">
        DELETE FROM `member` WHERE `uid` =#{s_id} and role=3;
    </delete>
    <update id="addGroupPic">
        update groupt set src=#{src} where gid=#{gid}
    </update>
    <insert id="addLeader2" parameterType="User">
        insert into member(uid,gid,role)
        SELECT #{s_id},gid,3 from groupt WHERE leader=#{s_id};
    </insert>
    <insert id="addGroup" parameterType="Groupt">
        insert into groupt(name,time,src,leader,number,response,introduction)
        values (#{name},#{time},#{src},#{leader},#{number},#{response},#{introduction})
    </insert>
    <insert id="addDiscuss" parameterType="Discuss">
        insert into discuss(uid,gid,tid,content,title,thumb,respose,time,top,star)
    values (#{uid},#{gid},#{tid},#{content},#{title},#{thumb},#{respose},#{time},0,0);
    </insert>
    <select id="getDiscussById" resultType="Discuss">
        select * from discuss where id=#{id};
    </select>
    <select id="listDiscussU" resultType="Discuss">
        select * from discuss where uid=#{uid};
    </select>
    <select id="listDiscussT" resultType="Discuss">
        select * from discuss where tid=#{tid};
    </select>
    <select id="listDiscussG" resultType="Discuss">
        select * from discuss where gid=#{gid};
    </select>
    <select id="findGroupByGid" resultType="Groupt">
        select * from groupt where gid=#{gid}; 
    </select>
    <select id="findGroupAll" resultType="Groupt">
        select * from groupt;
    </select>
    <select id="findGroupUidIn" resultType="Groupt">
        SELECT * FROM groupt
        WHERE gid in(
            SELECT gid FROM member WHERE uid=#{uid});
    </select>
    <select id="findGroupUidInManage" resultType="Groupt">
        SELECT * FROM groupt
        WHERE gid in(
            SELECT gid FROM member WHERE uid=#{uid} and role>1);
    </select>
    <select id="findMemberByGid" resultType="User">
        SELECT * FROM user
        WHERE s_id in(
            SELECT uid FROM member WHERE gid=#{gid});
    </select>
    <select id="findMemberByGid0" resultType="User">
        SELECT * FROM user
        WHERE s_id in(
            SELECT uid FROM member WHERE gid=#{gid} and role=1 and tom=0);
    </select>
    <select id="findMemberByGid1" resultType="User">
        SELECT * FROM user
        WHERE s_id in(
            SELECT uid FROM member WHERE gid=#{gid} and role=1 and tom=1);
    </select>
    <select id="findMemberByGid2" resultType="User">
        SELECT * FROM user
        WHERE s_id in(
            SELECT uid FROM member WHERE gid=#{gid} and role=2);
    </select>
    <select id="findIfUserInGroup" resultType="User">
        select * from user
        where s_id in(
            select uid from member where uid=#{uid} and gid=#{gid}
            )
    </select>
    <insert id="addIntoGroup">
        insert into member(uid,gid,role) values(#{uid},#{gid},#{role});
    </insert>
    <delete id="dropFromGroup">
        delete from member where uid=#{uid} and gid=#{gid};
    </delete>
    <update id="totop">
        update discuss set top=1 where id=#{id}
    </update>
    <update id="notop">
        update discuss set top=0 where id=#{id}
    </update>
    <update id="tostar">
        update discuss set star=1 where id=#{id}
    </update>
    <update id="nostar">
        update discuss set star=0 where id=#{id}
    </update>
    <delete id="delet">
        delete from discuss where id=#{id}
    </delete>
    <update id="setmanage">
        update member set role=#{role} where uid=#{uid} and gid=#{gid}
    </update>
    <update id="tomanager">
        update member set tom=1 where uid=#{uid} and gid=#{gid}
    </update>

</mapper>